---
title: "Cross Lagged Panel Models"
format:
  live-html:
    css: 
      - exams/webex.css
    include-after-body: exams/webex.js
toc: true    
lightbox: true
---

{{< include _extensions/r-wasm/live/_knitr.qmd >}}

## Grundidee
Die Grundidee von Cross Lagged Panel Models ist die Modellierung von wechselseitigen Einflüssen zwischen zwei oder mehr Variablen über die Zeit hinweg. Dabei wird angenommen, dass jede Variable nicht nur durch ihre eigenen vorherigen Werte (autoregressive Effekte) beeinflusst wird, sondern auch durch die vorherigen Werte der anderen Variablen [cross-lagged Effekte, @mackinnon2022, @hamaker2015]. Dies ermöglicht es unter bestimmten Annahmen, kausale Beziehungen zwischen den Variablen zu untersuchen und zu verstehen, wie Veränderungen in einer Variable Veränderungen in einer anderen Variable im Laufe der Zeit beeinflussen können.
Inwiefern die Annahmen für die kausale Interpretierbarkeit von Cross-Lagged Panel Models realistisch sind, gilt als stark diskutiert [eine unterhaltsame Einführung bietet @rohrer2025b].


## Datenimport
```{r}
#| message: false
#| warning: false
library(haven)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(colorspace)
library(tinytable)
library(lavaan)

data_star <- read_sav(
  "https://raw.githubusercontent.com/sammerk/WinterSchoolZH/master/data_star_workshop.sav"
)

data_star_subset <- data_star %>%
  group_by(classID) %>%
  summarize(
    MathClassMeanCl0 = mean(gktmathss, na.rm = T),
    MathClassMeanCl1 = mean(g1tmathss, na.rm = T),
    MathClassMeanCl2 = mean(g2tmathss, na.rm = T),
    MathClassMeanCl3 = mean(g3tmathss, na.rm = T),
    MathClassMeanCl4 = mean(g4tmathss, na.rm = T),
    SelfConRawCl1 = mean(g1selfconcraw, na.rm = T),
    SelfConRawCl2 = mean(g2selfconcraw, na.rm = T),
    SelfConRawCl3 = mean(g3selfconcraw, na.rm = T)
  )
```

## Cross Lagged Panel Model
```{r}
model_clp <- '

# autoregressive paths
SelfConRawCl2 ~ SelfConRawCl1
SelfConRawCl3 ~ SelfConRawCl2

MathClassMeanCl2 ~ MathClassMeanCl1
MathClassMeanCl3 ~ MathClassMeanCl2

# cross lagged paths
MathClassMeanCl2 ~ SelfConRawCl1
SelfConRawCl2 ~ MathClassMeanCl1
'


fit_clp <- sem(model_clp, data = data_star_subset)
summary(fit_clp)
parameterEstimates(fit_clp, standardized = T) %>%
  tt(digits = 3)
semPlot::semPaths(fit_clp, what = "std", fade = F)
```

